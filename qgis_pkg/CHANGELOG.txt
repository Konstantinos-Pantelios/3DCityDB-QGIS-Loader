2022-xx-xx TO DO
----------
Clean up old and redundant funtions in script 020.
Updating install script to be more similar to the one of 3DCityDB v. 4.x
Test whether it makes sense to add "hard-coded" bbox filter also to views.

2022-03-10
----------
MAJOR UPDATE!
All scripts are now prefixed with 3 digits
New names for variables: cty_schema, usr_name and usr_schema. schema_name mostly dropped everywhere.
For compatibility reasons, schema_name column is temporarily still in table layer_metadata
Fixed/improved generation of implicit geometries in m_views.
Added support for user-defined schemas. At the moment only "qgis_user"
	- Tables [layer_metadata], [extents], and for [enumerations] and [codelists] 
		are created	for each user schema
	- Added function [qgis_pkg.create_qgis_user_schema()]
Script 010-015
	- Dropped "old" way of defining serial types in tables
	- Fixed views for enumerations and codelists
Scripts 070 and 080 are now obsolete
Script 200 contains additional functions (to be merged into script 020)
Scripts 210...340 contain new [qgis_pkg.create_layers_xxxx()] functions
	- Functions correspond to CityGML modules
	- They are cdb_schema- and usr_schema-aware
	- Currently: CityFurniture, Generics, LandUse, Vegetation, Relief are done

2022-03-08
----------
Script 20: 
	- Renamed function [qgis_pkg.snap_poly_to_grid()] to [qgis_pkg.ST_Snap_poly_to_grid()]
	- Script 70 adapted accordingly
	- Added function [qgis_pkg.drop_layers()]
Script 70: Added mviews for remaining modules (Bridge, Tunnel, Transportation)
Script 80: Added mviews for remaining modules (Bridge, Tunnel, Transportation)
Corrected some bugs in update trigger functions (bdg thematic surfaces, tin relief)
Added (for now empty) columns for usr_name and usr_schema to tables [layer_metadata] and [extents]

2022-02-24
----------
Added script 15 (Look-up tables revised):
	Created tables [gis_pkg.codelist,gis_pkg.codelist_value,gis_pkg.enumeration, gis_pkg.enumeration_value]
	Created views [gis_pkg.v_codelist_value, gis_pkg.v_enumeration_value]
	Work in progress to reduce the number of look-up tables, lu_tables are still loaded in parallel
Script 20: Merged and harmonises Kostantinos' functions.

2022-02-22
----------
Script 30: Added remaining types. Now COMPLETE. Some unnecessary commented out.
Script 40: Added remaining upd_t-functions. Now COMPLETE, some unnecessary left out.
Script 50:
	DDL generation is now dynamic.
	Added remaining upd_v-functions. Now COMPLETE, some unnecessary left out.
Script 60:
	DDL generation is now dynamic.
	Added remaining trigger functions. Now COMPLETE, some unnecessary left out.
Script 80: Added more triggers

2022-02-18
----------
Script 10: Added table [qgis_pkg.extents]
Script 20: 
	Added function [qgis_pkg.compute_schema_extents()]
		Computes the extents of the whole city model in the chosed citydb schema
	Added function [qgis_pkg.upsert_extents()]
		Perform upsert operation on table [qgis_pkg.extents] to store the envelope values
	Added functions [qgis_pkg.create_mviews()] and [qgis_pkg.create_updatable_views()]
Script 70:
	Added mviews for WaterBody module
	Added code stubs for Transportation module (currently deactivated)
Script 80:
	Added views for WaterBody module
Script 90: Reworked and added more examples to install (m)views dynamically

2022-02-17
----------
Restructured file contents:
	10: Create schema qgis_pkg, create tables and look-up tables
	20: Create functions to be stored in schema qgis_pkg
	30: Create types corresponding to the 3DCityDB tables
	40: Update t(able) functions
	50: Update v(view) functions
	60: Trigger functions (insert, update, delete)
	70: DDL generation for materialized views
	80: DDL generation for views and triggers
	90: Miscellaneous (e.g. run function to refresh materialised views)
Reworked and improved metadata table for materialised views [qgis_pkg.layer_metadata]
Renamed and improved function [qgis_pkg.refresh_mview()]
	Improvements to better show partial and total elapsed time to refresh materialised views
	Count features for each materialised view and updates table [qgis_pkg.layer_metadata] 
Added function [qgis_pkg.ST_Area3d_poly()] to compute 3D area of polygons, independent from SFCGDAL 
Upgraded PostGIS' [ST_SnapToGrid()] function with own [qgis_pkg.snap_poly_to_grid()]
	Option to "do nothing"
	Option to set number of significant digits to round coordinates
	Option to set minimum area of polygons to be ignored
Upgraded scripts in 07 & 08 to generate DDL dynamically based on the chosen citydb schema
Upgraded scripts in 07: Major rework of the whole script structure
	Rewritten and added more queries to allow for automatic "smart" selection of geometries (XOR)
	Renamed layers: _geom_ to _g_, _building_ to _bdg_ etc. to shorten names
	Added (optional) "hard-coded" bbox selection
	Added (optional) parameters to be passed to [qgis_pkg.snap_poly_to_grid()]
	Currently generating 156 materialised views
		Building module complete
		Vegetation module complete
		Land use module complete
		City Furniture module complete
		Generic CityObject module complete
		Relief module: Relief Feature and TIN Relief
Upgraded scripts in 08: Major rework of the whole script structure
	Rewritten and added more queries
	Renamed layers according to the new naming schema for materialised views	
	Added dynamic generation of triggers
	Currently generating 156 views
		Not all are already updatable

2022-01-31
----------
Started restructuring materialized views (and views) according to new hierarchy after discussion with VCS
Renamed all names with *_bdg_* to *_building_*
Added ST_SnapToGrid function (and precision of 0.001) to geometries in materialised views.
	Details: https://postgis.net/docs/ST_SnapToGrid.html
WARNING: the actual queries for geometries in the materialized views need further updates
Slightly improved [qgis_pkg.refresh_materialized_view()] to show time needed to update materialized view(s)

2022-01-19:
----------
Renamed views for thematic surfaces adding "themsurf" to the name
Corrected some errors in triggers
Extended table qgis_pkg.materialized_views with columns "hierarchy" and "schema_name" 
TEMPORARY WORKAROUND: added hard-coded SRID to geometry columns of materialized views and views (any difference?)

2022-01-18:
----------
Added updatable views for relief feature, TIN relief and solitary vegetation object
Restructured update functions for tables and views
T- and V- and trigger functions made dynamic to be used with multiple citydb schemas
Rewritten function [qgis_pkg.refresh_materialized_view()] to work with schema_name and mat_view_name parameters
Code clean-up and some bugs removed

2022-01-04:
----------
Added materialized views for relief feature, TIN relief and solitary vegetation object geometries
Code restructured and cleaned up
Added function [qgis_pkg.refresh_materialized_view()]

2021-12-29
----------
Initial release
Materialized views for buildings, building installations geometries
Updatable views for buildings, building installations

-- END OF DOCUMENT --